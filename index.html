<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Christmas Gratitude | Centre for Social Action üéÑ</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
         :root {
            --glass: rgba(255, 255, 255, .18);
            --blur: blur(28px);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }
        
        body {
            min-height: 100vh;
            background: radial-gradient(1200px 600px at top, rgba(255, 255, 255, .08), transparent 60%), linear-gradient(180deg, #050b1f, #0b2540);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            font-family: system-ui, -apple-system;
        }
        /* Snow */
        
        .snow {
            position: fixed;
            top: -10px;
            pointer-events: none;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(110vh);
            }
        }
        /* Card */
        
        .card {
            max-width: 560px;
            width: 100%;
            padding: 38px 32px;
            border-radius: 28px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .22), rgba(255, 255, 255, .06));
            backdrop-filter: var(--blur) saturate(160%);
            box-shadow: 0 40px 90px rgba(0, 0, 0, .45);
            border: 1px solid var(--glass);
            text-align: center;
        }
        
        .subtitle {
            font-size: .95rem;
            opacity: .85;
            margin-bottom: 28px;
            line-height: 1.6;
        }
        
        input,
        textarea {
            width: 100%;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, .25);
            padding: 16px 18px;
            font-size: 1rem;
            background: rgba(255, 255, 255, .15);
            color: #fff;
            outline: none;
            margin-bottom: 14px;
        }
        
        textarea {
            min-height: 140px;
            resize: none;
        }
        
        button {
            width: 100%;
            padding: 16px;
            border-radius: 22px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            background: linear-gradient(180deg, #fff, #e6e6e6);
            color: #1a1a1a;
            margin-top: 12px;
        }
        /* Preview */
        
        .preview {
            display: none;
        }
        
        .letter {
            background: radial-gradient(circle at 20% 30%, rgba(139, 69, 19, .18), transparent 40%), radial-gradient(circle at 70% 60%, rgba(160, 82, 45, .15), transparent 45%), linear-gradient(180deg, #f5e6c8, #e6d3a3);
            color: #4b2e1e;
            padding: 28px 26px;
            border-radius: 14px;
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 18px;
            box-shadow: 0 18px 35px rgba(0, 0, 0, .35);
        }
        
        .letter .to {
            font-weight: 600;
            margin-bottom: 12px;
        }
        /* Drop animation */
        
        button.drop {
            animation: drop .6s ease forwards;
        }
        
        @keyframes drop {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(80px);
                opacity: 0;
            }
        }
        /* Seal */
        
        .seal-stage {
            display: none;
            text-align: center;
        }
        
        .paper {
            width: 220px;
            height: 160px;
            background: #f5e6c8;
            margin: 0 auto 18px;
            border-radius: 6px;
        }
        
        .seal {
            width: 48px;
            height: 48px;
            background: #8b1e1e;
            border-radius: 50%;
            margin: -24px auto 10px;
        }
        
        .success {
            display: none;
        }
    </style>
</head>

<body>

    <!-- FORM -->
    <div class="card" id="formBox">
        <h1>üéÑ Christmas Gratitude</h1>
        <p class="subtitle">Pause. Write. Read it once more.</p>

        <input id="recipient" placeholder="Who are you grateful for?" />
        <textarea id="message" placeholder="Write your gratitude here‚Ä¶"></textarea>

        <button onclick="showPreview()">Preview Letter üëÄ</button>
    </div>

    <!-- PREVIEW -->
    <div class="card preview" id="previewBox">
        <div class="letter">
            <div class="to" id="pTo"></div>
            <div id="pMessage"></div>
        </div>

        <button onclick="backToEdit()">‚úèÔ∏è Edit</button>
        <button id="finalSend" onclick="sendFinal()">‚úâÔ∏è Drop Letter</button>
    </div>

    <!-- SEAL -->
    <div class="card seal-stage" id="sealBox">
        <div class="paper"></div>
        <div class="seal"></div>
        <p>Your letter has been sealed.</p>
    </div>

    <!-- SUCCESS -->
    <div class="card success" id="successBox">
        <h1>ü§ç Thank You</h1>
        <p class="subtitle">Your gratitude has been received.</p>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAfg-H64wDdxB4NOpfSDVzY9z-iUxaT7gI",
            authDomain: "csa-christmas-gratitude.firebaseapp.com",
            projectId: "csa-christmas-gratitude"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function showPreview() {
            if (!recipient.value || !message.value) {
                return alert("Please fill all fields ü§ç");
            }

            formBox.style.display = "none";
            previewBox.style.display = "block";

            pTo.textContent = "To: " + recipient.value;
            pMessage.textContent = message.value;
        }

        function backToEdit() {
            previewBox.style.display = "none";
            formBox.style.display = "block";
        }

        async function sendFinal() {
            finalSend.classList.add("drop");

            await db.collection("messages").add({
                recipient: recipient.value,
                message: message.value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            setTimeout(() => {
                previewBox.style.display = "none";
                sealBox.style.display = "block";
            }, 600);

            setTimeout(() => {
                sealBox.style.display = "none";
                successBox.style.display = "block";
            }, 1800);
        }

        /* Snow */
        for (let i = 0; i < 40; i++) {
            const s = document.createElement("div");
            s.className = "snow";
            s.textContent = "‚ùÑ";
            s.style.left = Math.random() * 100 + "vw";
            s.style.animationDuration = (Math.random() * 6 + 4) + "s";
            s.style.opacity = Math.random();
            document.body.appendChild(s);
        }
    </script>

</body>

</html>